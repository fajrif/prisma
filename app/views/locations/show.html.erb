<%= render "shared/setting_banners" %>

<!-- start post content section -->
<section class="half-section">
    <div class="container">
        <div class="row">
          <div class="col-12 col-lg-3">
            <div class="text-extra-dark-gray margin-25px-bottom alt-font text-uppercase font-weight-600"><span><%= "#{t('locations.title')}: #{@location.name}" %></span></div>
          </div>
        </div>
        <div class="row flex-nowrap h-600px">
          <% unless @products.any? %>
            <aside class="col-xl-3 col-lg-4 col-md-7 d-flex flex-column sm-margin-25px-bottom">
                <div class="flex-grow-1 overflow-auto">
                  <ul id="product-list" class="latest-post position-relative">
                    <% @products.each do |product| %>
                      <li class="media d-flex gap-2 product-item border border-radius-8"
                        data-product-id="<%= product.id %>"
                        data-lat="<%= product.latitude %>"
                        data-lng="<%= product.longitude %>"
                        >
                        <figure class="flex-shrink-0 border border-radius-8">
                          <% if product.image_url_thumb.present? %>
                            <img src="<%= product.image_url_thumb %>" class="border-radius-8" alt="<%= product.name %>">
                          <% end %>
                        </figure>
                        <div class="media-body flex-grow-1 text-medium">
                          <span class="d-inline-block margin-5px-bottom fw-semibold"><%= product.name %></span>
                          <span class="d-block text-extra-dark-gray text-small"><%= product.est_impression %></span>
                        </div>
                      </li>
                    <% end %>
                  </ul>
                </div>
            </aside>
            <article class="col-xl-9 col-lg-8 left-sidebar sm-margin-40px-bottom">
              <div id="map" class="w-100 h-100"></div>
              <!-- Hidden data for JavaScript -->
              <div id="map-data"
                   data-products='<%= raw @products.to_json(only: [:id, :name, :latitude, :longitude, :est_impression], methods: [:image_url_thumb]) %>'
                   data-center-lat="<%= @products.first&.latitude || -6.2088 %>"
                   data-center-lng="<%= @products.first&.longitude || 106.8456 %>">
              </div>
            </article>
          <% else %>
            <span id="no-data-message" class="text-center text-medium padding-15px">No products available for this location.</span>
          <% end %>
        </div>
    </div>
</section>
<!-- end blog content section -->

<%= content_for :tail do %>
  <%= javascript_include_tag "locations" %>
  <%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?key=#{ENV['PRISMA_GOOGLE_API_KEY']}&callback=initMap&loading=async", async: true, defer: true %>

  <style>
    .product-item {
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .product-item:hover {
      background-color: #f8f9fa;
    }

    .product-item.selected {
      background-color: #2c3e50 !important;
      border-color: var(--base-color) !important;
    }

    .product-item.selected .media-body span {
      color: #fff !important;
    }

    .gm-style-iw {
      max-width: 250px;
    }
  </style>
  <!-- app/views/locations/show.html.erb -->
  <style>
    /* Target the InfoWindow container */
    .gm-style .gm-style-iw-c {
      background-color: #2c3e50 !important;
      padding: 0 !important;
      border: 1px solid;
      border-radius: 12px !important;
      border-color: var(--base-color);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
    }

    /* Target the InfoWindow content wrapper */
    .gm-style .gm-style-iw-d {
      overflow: auto !important;
      max-height: none !important;
    }

    /* Remove default padding */
    .gm-style .gm-style-iw-t::after {
      background: #2c3e50 !important;
    }

    /* Style the close button */
    .gm-style-iw button {
      background-color: transparent !important;
      filter: brightness(0) invert(1); /* Make close button white */
      /*top: 8px !important;
      right: 8px !important;*/
    }

    .gm-style-iw button img {
    }

    .gm-style .gm-style-iw-tc::after {
      background-color: #2c3e50;
    }

    /* Custom content styling */
    .info-window-content {
      background-color: #2c3e50;
      color: #ffffff;
      padding: 0 15px 15px;
      border-radius: 12px;
      min-width: 200px;
    }

    .info-window-content h6 {
      color: #ffffff;
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .info-window-content p {
      color: #ecf0f1;
      margin-bottom: 8px;
    }

    .info-window-content img {
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .info-window-content strong {
      color: #3498db;
    }

    .info-window-content small {
      color: #bdc3c7;
    }
  </style>
<% end %>
