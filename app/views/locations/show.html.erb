<%= render "shared/setting_banners" %>

<!-- start post content section -->
<section class="half-section">
    <div class="container">
        <div class="row align-items-center mb-4">
          <div class="col-12 col-lg-3 col-md-3">
            <div class="d-flex justify-content-lg-start align-items-center gap-2">
              <label for="billboard-type-filter" class="font-weight-600 mb-0 text-nowrap">Filter by Billboard Type:</label>
              <select id="billboard-type-filter" class="form-select form-select-sm mb-0" style="width: auto;" data-location-id="<%= @location.slug %>">
                <option value="">All Types</option>
                <option value="digital">Digital Billboard</option>
                <option value="static">Static Billboard</option>
              </select>
            </div>
          </div>
          <div class="col-12 col-lg-9 col-md-9 text-center mt-3 mt-lg-0">
            <div class="text-extra-dark-gray alt-font text-uppercase font-weight-600"><span><%= "#{t('locations.name')}: #{@location.name}" %></span></div>
          </div>
        </div>
        <div class="row flex-nowrap h-600px">
          <% unless @products.empty? %>
            <aside class="col-xl-3 col-lg-4 col-md-7 d-flex flex-column sm-margin-25px-bottom">
                <div class="flex-grow-1 overflow-auto">
                  <ul id="product-list" class="latest-post position-relative">
                    <%= render "products_list", products: @products %>
                  </ul>
                </div>
            </aside>
            <article class="col-xl-9 col-lg-8 left-sidebar sm-margin-40px-bottom">
              <div id="map" class="w-100 h-100"></div>
              <!-- Hidden data for JavaScript -->
              <%= render "map_data", products: @products %>
            </article>
          <% else %>
            <span id="no-data-message" class="text-center text-medium padding-15px">No products available for this location.</span>
          <% end %>
        </div>
    </div>
</section>
<!-- end blog content section -->

<%= content_for :tail do %>
  <%= javascript_include_tag "locations" %>
  <%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?key=#{ENV['PRISMA_GOOGLE_API_KEY']}&callback=initMap&loading=async", async: true, defer: true %>

  <style>
    .product-item {
      cursor: pointer;
      transition: background-color 0.3s;
      box-shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3), 
              0 1px 3px 1px rgba(60, 64, 67, 0.15);
    }

    .product-item:hover {
      background-color: #f8f9fa;
    }

    .product-item.selected {
      background-color: #000000 !important;
      border: 2px solid !important;
      border-color: var(--base-color) !important;
    }

    .product-item.selected .media-body span {
      color: #fff !important;
    }

    .gm-style-iw {
      max-width: 250px;
    }
    #map {
      box-shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3),
              0 1px 3px 1px rgba(60, 64, 67, 0.15);
    }
  </style>
  <!-- app/views/locations/show.html.erb -->
  <style>
    /* Custom info window styling - only targets our custom markers */
    /* These styles apply when the info window contains .custom-info-window wrapper */
    .gm-style .gm-style-iw-c:has(.custom-info-window) {
      background-color: #000000 !important;
      padding: 0 !important;
      border: 2px solid;
      border-radius: 12px !important;
      border-color: var(--base-color);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
    }

    /* Target the InfoWindow content wrapper for custom info windows */
    .gm-style .gm-style-iw-c:has(.custom-info-window) .gm-style-iw-d {
      overflow: auto !important;
      max-height: none !important;
    }

    /* Arrow styling for custom info windows */
    .gm-style .gm-style-iw-tc:has(+ .gm-style-iw-c .custom-info-window)::after,
    .gm-style .gm-style-iw-t:has(.custom-info-window)::after {
      background: #000000 !important;
    }

    /* Style the close button for custom info windows */
    .gm-style .gm-style-iw-c:has(.custom-info-window) button {
      background-color: transparent !important;
      filter: brightness(0) invert(1); /* Make close button white */
    }

    /* Custom content styling */
    .custom-info-window {
      background-color: #000000;
      color: #ffffff;
      padding: 0 15px 15px;
      border-radius: 12px;
      min-width: 200px;
    }

    .custom-info-window h6 {
      color: #ffffff;
      margin-bottom: 10px;
      font-size: 1.1em;
    }

    .custom-info-window p {
      color: #ecf0f1;
      margin-bottom: 8px;
    }

    .custom-info-window img {
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .custom-info-window strong {
      color: #3498db;
    }

    .custom-info-window small {
      color: #bdc3c7;
    }
  </style>
<% end %>
